#!/usr/bin/env python

import config
from hackeriet import mifare
from hackeriet.users.users import Users
import uuid

users = Users()

if hasattr(config, "keyA"): mifare.keyA = config.keyA
if hasattr(config, "keyB"): mifare.keyB = config.keyB

def add_user(user, card_data, realname="", phone="", email="", address=""):
    users.add_user(user, phone, email, address)
    users.update_card_data(user, card_data)
    mifare.write_sector(card_data)

user     = input("Username: ")
realname = input("Real name: ")
email    = input("E-mail: ")
phone    = input("Phone number: ")
address  = input("Address: ")

print("Hold card to reader and press Enter")
input()

card_data = uuid.uuid4().bytes

add_user(user, card_data, realname, phone, email, address)

print(users.get_card_user(mifare.read_sector(7)[0:16]))


